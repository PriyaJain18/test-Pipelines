pipeline { 
    agent any          //where to execute(which node etc)
    //pipeline + agent = node in groovy script 
    
    environment {
       NEW_VERSION = '1.3.1'
       SERVER_CREDENTIALS = credentials('github-credentials')
    }
    
    stages {
        stage("build"){
         when{
                expression{
                   BRANCH_NAME == 'main' || BRANCH_NAME == 'maser && CODE_CHANGES == true;              //BRANCH_NAME and CODE_CHANGES -> environment variables by Jenkins        
                }
            }
            steps{
                echo 'building app';                     
                echo "built version $(NEW_VERSION)";       //Use Double-quotes when accessing a varibale etc inside a sentence , oherwise use Single ' ' normally 
            }
        }
        stage("test"){
           
            steps{
                echo "testing app with $(SERVER_CREDENTAIALS)"
            }
        }
        
        stage("deploy"){
           
            steps{
                echo 'deploying app ...'
                withCredentials([ 
                    usernamePassword(credentials: 'github-credentials' , usernameVariable: USER , password: PWD) 
                ]) {
                    sh "some script ${USER} ${PWD}"
                }
            }
        }
    }
    post{
       always{
           echo "always executed code appears" 
       }
       failure{
           echo "Pipeline Failed" 
       }
    }
}
